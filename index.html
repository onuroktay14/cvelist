<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CVE Takip - Onr Mode</title>
    <style>
        body { font-family: sans-serif; background: #f4f4f9; padding: 20px; }
        .container { max-width: 800px; margin: auto; }
        .card { background: white; padding: 15px; margin-bottom: 10px; border-radius: 8px; border-left: 5px solid #2c3e50; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        .debug-box { background: #333; color: #0f0; padding: 10px; font-family: monospace; font-size: 12px; margin-bottom: 20px; border-radius: 5px; overflow: auto; max-height: 200px; }
        .cve-id { font-weight: bold; color: #e74c3c; font-size: 1.1em; }
        .puan { float: right; font-weight: bold; background: #eee; padding: 2px 8px; border-radius: 4px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>CVE Takip Sistemi</h1>
        <div id="debug" class="debug-box">Veri yapısı kontrol ediliyor...</div>
        <div id="list">Yükleniyor...</div>
    </div>

    <script>
        async function checkData() {
            const listDiv = document.getElementById('list');
            const debugDiv = document.getElementById('debug');
            
            try {
                // Tarayıcı önbelleğini (cache) kırmak için her seferinde farklı bir sayı ekliyoruz
                const response = await fetch('./data.json?nocache=' + Math.random());
                const data = await response.json();

                if (!data || data.length === 0) {
                    debugDiv.innerText = "Hata: data.json dosyası boş veya okunamadı.";
                    return;
                }

                // Gelen ilk verinin içindeki gerçek anahtar isimlerini debug kutusuna yazalım
                const keys = Object.keys(data[0]);
                debugDiv.innerText = "API'den Gelen Anahtarlar: " + keys.join(", ") + "\nÖrnek Veri: " + JSON.stringify(data[0]).substring(0, 100) + "...";

                listDiv.innerHTML = '';
                
                data.slice(0, 20).forEach(item => {
                    // CIRCL API bazen veriyi 'id' değil 'Modified' veya farklı isimlerle verebilir
                    // En yaygın anahtarları tek tek deniyoruz:
                    const cveId = item.id || item.ID || item.cve_id || "ID Yok";
                    const summary = item.summary || item.Summary || item.description || "Açıklama mevcut değil.";
                    const cvss = item.cvss || item.cvss_score || "N/A";

                    const card = document.createElement('div');
                    card.className = 'card';
                    card.innerHTML = `
                        <span class="puan">CVSS: ${cvss}</span>
                        <div class="cve-id">${cveId}</div>
                        <p>${summary}</p>
                        <a href="https://nvd.nist.gov/vuln/detail/${cveId}" target="_blank">Detayları Gör</a>
                    `;
                    listDiv.appendChild(card);
                });

            } catch (err) {
                debugDiv.innerText = "Hata: " + err.message;
                listDiv.innerText = "Veriler yüklenirken bir hata oluştu. GitHub Actions'ın data.json'ı oluşturduğundan emin olun.";
            }
        }
        checkData();
    </script>
</body>
</html>
