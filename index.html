<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CVE Takip</title>
    <style>
        :root { --primary: #2c3e50; --danger: #e74c3c; --warning: #f39c12; --success: #27ae60; --light: #ecf0f1; }
        body { font-family: 'Segoe UI', system-ui, sans-serif; background: #f4f7f6; color: #333; margin: 0; padding: 20px; }
        .container { max-width: 1000px; margin: auto; }
        header { text-align: center; padding: 20px 0; border-bottom: 2px solid var(--light); margin-bottom: 30px; }
        h1 { color: var(--primary); margin: 0; }
        .status-bar { font-size: 0.9rem; color: #666; margin-top: 10px; }
        
        #cve-list { display: grid; gap: 15px; }
        .cve-card { background: white; padding: 20px; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.05); border-left: 6px solid #ccc; transition: 0.2s; }
        .cve-card:hover { transform: scale(1.01); box-shadow: 0 6px 12px rgba(0,0,0,0.1); }
        
        .cve-header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 12px; }
        .cve-id { font-size: 1.25rem; font-weight: 800; color: var(--danger); text-decoration: none; }
        .cve-id:hover { text-decoration: underline; }
        
        .cvss-badge { padding: 5px 12px; border-radius: 6px; font-weight: bold; font-size: 0.85rem; background: var(--light); }
        .cvss-high { background: var(--danger); color: white; }
        .cvss-medium { background: var(--warning); color: white; }
        
        p { margin: 0; font-size: 0.95rem; color: #444; line-height: 1.5; }
        .meta { margin-top: 15px; font-size: 0.8rem; color: #888; display: flex; gap: 15px; }
    </style>
</head>
<body>

<div class="container">
    <header>
        <h1>CVE Takip List</h1>
        <div id="update-info" class="status-bar">Veriler y√ºkleniyor...</div>
    </header>

    <div id="cve-list">
        </div>
</div>

<script>
    async function fetchCVEs() {
        const listContainer = document.getElementById('cve-list');
        const updateInfo = document.getElementById('update-info');

        try {
            // Cache engellemek i√ßin t= timestamp ekliyoruz
            const response = await fetch('./data.json?t=' + new Date().getTime());
            const data = await response.json();

            // Konsolda veriyi incelemek i√ßin (F12 > Console)
            console.log("Gelen Veri Yapƒ±sƒ±:", data);

            if (!Array.isArray(data) || data.length === 0) {
                updateInfo.innerText = "‚ö†Ô∏è Veri dosyasƒ± hen√ºz g√ºncellenmemi≈ü veya bo≈ü.";
                return;
            }

            updateInfo.innerText = `Son G√ºncelleme: ${new Date().toLocaleString('tr-TR')} | Toplam: ${data.length} kayƒ±t`;
            listContainer.innerHTML = '';

            data.slice(0, 30).forEach(item => {
                // API'den gelen farklƒ± anahtar isimlerini kontrol ediyoruz (id, ID, summary, Summary vb.)
                const id = item.id || item.ID || "N/A";
                const summary = item.summary || item.Summary || item.description || "A√ßƒ±klama bulunamadƒ±.";
                const cvss = parseFloat(item.cvss || item.cvss_score) || 0;
                
                let cvssClass = '';
                if (cvss >= 7) cvssClass = 'cvss-high';
                else if (cvss >= 4) cvssClass = 'cvss-medium';

                const card = document.createElement('div');
                card.className = 'cve-card';
                card.style.borderLeftColor = cvss >= 7 ? 'var(--danger)' : (cvss >= 4 ? 'var(--warning)' : '#ccc');

                card.innerHTML = `
                    <div class="cve-header">
                        <a href="https://nvd.nist.gov/vuln/detail/${id}" target="_blank" class="cve-id">${id}</a>
                        <span class="cvss-badge ${cvssClass}">CVSS: ${cvss > 0 ? cvss : 'Belirlenmedi'}</span>
                    </div>
                    <p>${summary}</p>
                    <div class="meta">
                        <span>üìÖ ${item.Published || 'Tarih Bilgisi Yok'}</span>
                        <span>üîç Kaynak: CIRCL API</span>
                    </div>
                `;
                listContainer.appendChild(card);
            });

        } catch (error) {
            console.error("Hata Detayƒ±:", error);
            updateInfo.innerText = "‚ùå Veri y√ºkleme hatasƒ±! data.json dosyasƒ± hen√ºz olu≈üturulmamƒ±≈ü olabilir.";
        }
    }

    // Sayfa a√ßƒ±ldƒ±ƒüƒ±nda verileri √ßek
    fetchCVEs();
</script>

</body>
</html>
