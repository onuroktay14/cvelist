<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CVE Takip Paneli</title>
    <style>
        :root { --primary: #1a1a2e; --danger: #e94560; --warning: #f8b400; --text: #333; }
        body { font-family: 'Inter', system-ui, sans-serif; background: #f0f2f5; color: var(--text); padding: 20px; }
        .container { max-width: 900px; margin: auto; }
        h1 { text-align: center; color: var(--primary); margin-bottom: 30px; }
        #update-status { text-align: center; font-size: 0.85rem; color: #666; margin-bottom: 20px; }
        .cve-card { background: white; padding: 20px; border-radius: 12px; margin-bottom: 15px; box-shadow: 0 2px 8px rgba(0,0,0,0.08); border-left: 6px solid #ccc; }
        .cve-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
        .cve-id { font-weight: 800; font-size: 1.2rem; color: var(--danger); text-decoration: none; }
        .cvss-badge { font-weight: bold; padding: 4px 10px; border-radius: 6px; background: #eee; font-size: 0.85rem; }
        .high { background: var(--danger); color: white; }
        .summary { font-size: 0.95rem; line-height: 1.5; color: #444; }
        .footer-meta { margin-top: 10px; font-size: 0.75rem; color: #999; border-top: 1px solid #eee; pt: 10px; }
    </style>
</head>
<body>

<div class="container">
    <h1>Güncel CVE Takip</h1>
    <div id="update-status">Veriler kontrol ediliyor...</div>
    <div id="cve-list"></div>
</div>

<script>
    async function loadData() {
        const container = document.getElementById('cve-list');
        const status = document.getElementById('update-status');

        try {
            // Veriyi çek (Önbelleği önlemek için t= ekledik)
            const response = await fetch('./data.json?t=' + Date.now());
            const data = await response.json();

            // Konsol Log: Verinin yapısını incelemek için (Hata olursa buraya bakacağız)
            console.log("Gelen Veri:", data);

            if (!Array.isArray(data)) {
                status.innerText = "Hata: Veri formatı liste değil.";
                return;
            }

            status.innerText = `Son ${data.length} zafiyet başarıyla yüklendi.`;
            container.innerHTML = '';

            data.slice(0, 30).forEach(item => {
                // Veri Yapısını Akıllıca Çözümle (Farklı isim ihtimallerini kontrol eder)
                const cveId = item.id || item.ID || item.cve_id || "Bilinmiyor";
                const cveSummary = item.summary || item.Summary || item.description || item.Summary_en || "Açıklama mevcut değil.";
                const cvss = parseFloat(item.cvss || item.cvss_score || item.cvss_v3) || 0;
                const pubDate = item.Published || item.published_at || item.last_modified || "-";

                // Puan Renklendirme
                let cvssClass = '';
                if (cvss >= 7) cvssClass = 'high';

                const card = document.createElement('div');
                card.className = 'cve-card';
                if(cvss >= 7) card.style.borderColor = 'var(--danger)';
                else if(cvss >= 4) card.style.borderColor = 'var(--warning)';

                card.innerHTML = `
                    <div class="cve-header">
                        <a href="https://nvd.nist.gov/vuln/detail/${cveId}" target="_blank" class="cve-id">${cveId}</a>
                        <span class="cvss-badge ${cvssClass}">CVSS: ${cvss > 0 ? cvss : 'N/A'}</span>
                    </div>
                    <div class="summary">${cveSummary}</div>
                    <div class="footer-meta">
                        Yayınlanma: ${pubDate} | Kaynak: CIRCL API
                    </div>
                `;
                container.appendChild(card);
            });

        } catch (e) {
            console.error(e);
            status.innerText = "Veri yüklenirken hata oluştu. Lütfen data.json dosyasını kontrol edin.";
        }
    }

    loadData();
</script>
</body>
</html>
