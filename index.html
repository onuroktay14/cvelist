<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SOC Dashboard | CVE Tracker</title>
    <style>
        :root { 
            --bg: #0f172a; --card-bg: #1e293b; --text: #f8fafc;
            --accent: #38bdf8; --danger: #ef4444; --warning: #f59e0b; 
            --exploit: #d946ef; --success: #10b981; --border: #334155;
        }
        * { box-sizing: border-box; }
        body { font-family: 'Inter', system-ui, sans-serif; background: var(--bg); color: var(--text); padding: 20px; margin: 0; }
        
        .container { max-width: 1600px; margin: auto; }
        
        header { text-align: left; margin-bottom: 30px; border-left: 5px solid var(--accent); padding-left: 20px; }
        header h1 { margin: 0; font-size: 1.8rem; letter-spacing: -1px; }
        #status { font-size: 0.85rem; color: #94a3b8; margin-top: 5px; }

        /* Arama ve Filtreler */
        .controls { 
            display: flex; flex-wrap: wrap; gap: 15px; align-items: center; 
            background: var(--card-bg); padding: 15px; border-radius: 12px; margin-bottom: 30px; border: 1px solid var(--border);
        }
        #search-input { 
            flex: 1; min-width: 250px; background: #0f172a; border: 1px solid var(--border); 
            padding: 10px 20px; border-radius: 8px; color: white; outline: none;
        }
        .filter-group { display: flex; gap: 8px; flex-wrap: wrap; }
        .btn-filter { 
            padding: 8px 14px; border-radius: 6px; border: 1px solid var(--border); 
            background: #334155; color: #cbd5e1; cursor: pointer; font-size: 0.8rem; font-weight: 600;
        }
        .btn-filter.active { background: var(--accent); color: var(--bg); border-color: var(--accent); }

        /* Dashboard Grid Yapƒ±sƒ± (Yan yana dizilim) */
        #cve-list { 
            display: grid; 
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)); 
            gap: 20px; 
        }

        /* K√º√ß√ºk Renkli Kutucuklar (Cards) */
        .cve-card { 
            background: var(--card-bg); border-radius: 12px; padding: 18px; 
            border: 1px solid var(--border); display: flex; flex-direction: column;
            position: relative; transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            overflow: hidden; min-height: 220px;
        }
        .cve-card:hover { transform: translateY(-5px); border-color: var(--accent); box-shadow: 0 10px 20px -10px rgba(56, 189, 248, 0.3); }

        /* Kritiklik Renkleri */
        .cve-card.critical { border-top: 4px solid var(--danger); }
        .cve-card.high { border-top: 4px solid var(--warning); }
        .cve-card.medium { border-top: 4px solid var(--accent); }

        .exploit-indicator { 
            position: absolute; top: 0; right: 0; background: var(--exploit); 
            color: white; font-size: 0.65rem; padding: 4px 8px; font-weight: 900;
            border-bottom-left-radius: 8px; animation: blink 1.5s infinite;
        }
        @keyframes blink { 0% { opacity: 1; } 50% { opacity: 0.5; } 100% { opacity: 1; } }

        .cve-header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 10px; }
        .cve-id { font-weight: 800; font-size: 1.1rem; color: var(--accent); text-decoration: none; }
        
        .cvss-box { 
            background: #334155; padding: 4px 8px; border-radius: 6px; 
            font-size: 0.8rem; font-weight: bold; color: var(--text);
        }
        .score-red { color: var(--danger); }

        .product-info { font-size: 0.75rem; color: #94a3b8; font-weight: 700; margin-bottom: 8px; text-transform: uppercase; }
        
        .desc { 
            font-size: 0.85rem; color: #cbd5e1; line-height: 1.4; 
            display: -webkit-box; -webkit-line-clamp: 3; -webkit-box-orient: vertical; 
            overflow: hidden; margin-bottom: 15px; flex-grow: 1;
        }

        .meta-footer { 
            display: flex; justify-content: space-between; align-items: center; 
            font-size: 0.7rem; border-top: 1px solid var(--border); pt: 10px; margin-top: auto; padding-top: 10px;
        }
        .mapping-links a { color: var(--success); text-decoration: none; font-weight: bold; margin-right: 5px; }
    </style>
</head>
<body>

<div class="container">
    <header>
        <h1>VULNERABILITY DASHBOARD</h1>
        <div id="status">Sistem taranƒ±yor...</div>
    </header>

    <div class="controls">
        <input type="text" id="search-input" placeholder="√úr√ºn, firma veya CVE kodu ara...">
        <div class="filter-group">
            <button class="btn-filter active" onclick="setFilter('all', this)">T√úM√ú</button>
            <button class="btn-filter" onclick="setFilter('exploited', this)">EXPLOITED</button>
            <button class="btn-filter" onclick="setFilter('critical', this)">CRITICAL</button>
        </div>
    </div>

    <div id="cve-list"></div>
</div>

<script>
    let allCVEs = [];
    let filter = 'all';

    async function init() {
        try {
            const res = await fetch('./data.json?t=' + Date.now());
            allCVEs = await res.json();
            // Puanƒ±na g√∂re sƒ±rala
            allCVEs.sort((a, b) => getScore(b) - getScore(a));
            apply();
            
            document.getElementById('search-input').addEventListener('input', apply);
        } catch (e) { document.getElementById('status').innerText = "Veri y√ºklenemedi."; }
    }

    function getScore(item) {
        let max = 0;
        const metrics = [...(item.containers?.cna?.metrics || []), ...(item.containers?.adp?.[0]?.metrics || [])];
        metrics.forEach(m => {
            const s = m.cvssV3_1?.baseScore || m.cvssV3_0?.baseScore || m.cvssV2?.baseScore || 0;
            if (s > max) max = s;
        });
        return max;
    }

    function setFilter(f, el) {
        filter = f;
        document.querySelectorAll('.btn-filter').forEach(b => b.classList.remove('active'));
        el.classList.add('active');
        apply();
    }

    function apply() {
        const term = document.getElementById('search-input').value.toLowerCase();
        const filtered = allCVEs.filter(item => {
            const score = getScore(item);
            const isExp = item.is_exploited || false;
            const textMatch = (item.containers?.cna?.descriptions?.[0]?.value || "").toLowerCase().includes(term) ||
                              (item.cveMetadata?.cveId || "").toLowerCase().includes(term) ||
                              (item.containers?.cna?.affected || []).some(p => (p.product || "").toLowerCase().includes(term));
            
            if (filter === 'exploited') return isExp && textMatch;
            if (filter === 'critical') return score >= 9.0 && textMatch;
            return textMatch;
        });
        render(filtered);
    }

    function render(data) {
        const container = document.getElementById('cve-list');
        // SON 100 KAYIT SINIRI
        const displayData = data.slice(0, 100);
        document.getElementById('status').innerText = `SON 100 ANALƒ∞Z ƒ∞√áƒ∞NDEN ${displayData.length} KAYIT Lƒ∞STELENƒ∞YOR`;
        container.innerHTML = '';

        displayData.forEach(item => {
            const score = getScore(item);
            const cveId = item.cveMetadata?.cveId || "N/A";
            const product = item.containers?.cna?.affected?.[0]?.product || "Bilinmiyor";
            const isExploited = item.is_exploited || false;

            let levelClass = '';
            if (score >= 9) levelClass = 'critical';
            else if (score >= 7) levelClass = 'high';
            else if (score >= 4) levelClass = 'medium';

            const card = document.createElement('div');
            card.className = `cve-card ${levelClass}`;
            card.innerHTML = `
                ${isExploited ? '<div class="exploit-indicator">EXPLOIT ACTIVE</div>' : ''}
                <div class="cve-header">
                    <a href="https://nvd.nist.gov/vuln/detail/${cveId}" target="_blank" class="cve-id">${cveId}</a>
                    <div class="cvss-box ${score >= 9 ? 'score-red' : ''}">${score > 0 ? score.toFixed(1) : 'N/A'}</div>
                </div>
                <div class="product-info">${product}</div>
                <div class="desc">${item.containers?.cna?.descriptions?.[0]?.value || 'Detay yok.'}</div>
                <div class="meta-footer">
                    <div class="mapping-links">
                        <a href="https://attack.mitre.org/search/?search=${product}" target="_blank">‚öîÔ∏è MITRE</a>
                        <a href="https://www.google.com/search?q=${cveId}+poc+github" target="_blank">üîç PoC</a>
                    </div>
                    <span>${item.cveMetadata?.datePublished?.split('T')[0] || '-'}</span>
                </div>
            `;
            container.appendChild(card);
        });
    }
    init();
</script>
</body>
</html>
