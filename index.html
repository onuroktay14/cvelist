<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aktif CVE ve Exploit Takip Sistemi</title>
    <style>
        :root { 
            --primary: #1a202c; --accent: #3182ce; --danger: #e53e3e; 
            --warning: #dd6b20; --exploit: #805ad5; --success: #38a169; --bg: #f7fafc;
        }
        body { font-family: 'Inter', system-ui, sans-serif; background: var(--bg); color: #2d3748; padding: 20px; }
        .container { max-width: 1000px; margin: auto; }
        
        header { text-align: center; margin-bottom: 25px; border-bottom: 3px solid var(--accent); padding-bottom: 15px; }
        
        /* Arama ve Filtre Alanƒ± */
        .controls { background: white; padding: 20px; border-radius: 15px; box-shadow: 0 4px 6px rgba(0,0,0,0.05); margin-bottom: 25px; text-align: center; }
        #search-input { 
            width: 90%; max-width: 500px; padding: 12px 20px; border-radius: 25px; 
            border: 2px solid #e2e8f0; font-size: 1rem; margin-bottom: 15px; outline: none;
        }
        
        .filter-group { display: flex; flex-wrap: wrap; justify-content: center; gap: 10px; margin-top: 10px; }
        .btn-filter { 
            padding: 8px 16px; border-radius: 20px; border: 1px solid #cbd5e0; 
            background: white; cursor: pointer; font-weight: 600; font-size: 0.85rem; 
            transition: 0.2s; color: #4a5568;
        }
        .btn-filter:hover { background: #edf2f7; }
        .btn-filter.active { background: var(--accent); color: white; border-color: var(--accent); }
        .btn-exploited.active { background: var(--exploit); border-color: var(--exploit); }
        .btn-critical.active { background: var(--danger); border-color: var(--danger); }

        #status { font-weight: 600; font-size: 0.9rem; color: #718096; margin-top: 15px; }

        /* Kart Yapƒ±sƒ± */
        .cve-card { 
            background: white; border-radius: 12px; padding: 25px; margin-bottom: 20px; 
            box-shadow: 0 4px 6px rgba(0,0,0,0.05); border-left: 8px solid #cbd5e0; 
            position: relative; transition: 0.2s;
        }
        .exploit-badge { 
            position: absolute; top: -12px; right: 20px; background: var(--exploit); 
            color: white; padding: 6px 14px; border-radius: 8px; font-weight: 900; 
            font-size: 0.75rem; animation: pulse 2s infinite; border: 2px solid white;
        }
        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.05); } 100% { transform: scale(1); } }

        .cve-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px; }
        .cve-id { font-size: 1.3rem; font-weight: 800; color: var(--accent); text-decoration: none; }
        
        .cvss-badge { padding: 4px 10px; border-radius: 6px; font-weight: bold; font-size: 0.85rem; background: #edf2f7; }
        .high-score { background: var(--danger); color: white; }

        .desc { font-size: 0.95rem; color: #4a5568; background: #f8fafc; padding: 12px; border-radius: 8px; margin: 12px 0; border: 1px solid #e2e8f0; }
        .product-tag { background: #e2e8f0; color: #2d3748; padding: 2px 8px; border-radius: 4px; font-size: 0.75rem; margin-right: 5px; font-weight: bold; }
        .cwe-tag { display: inline-block; background: #ebf8ff; color: #2b6cb0; padding: 2px 8px; border-radius: 4px; font-size: 0.75rem; margin-right: 5px; text-decoration: none; font-weight: bold; border: 1px solid #bee3f8; }

        .meta-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 10px; font-size: 0.75rem; color: #718096; margin-top: 15px; padding-top: 15px; border-top: 1px solid #edf2f7; }
        .attack-link { color: var(--exploit); font-weight: 800; text-decoration: none; }
    </style>
</head>
<body>

<div class="container">
    <header>
        <h1>Aktif CVE & Exploit Takip Sistemi</h1>
    </header>

    <div class="controls">
        <input type="text" id="search-input" placeholder="√úr√ºn, Plugin veya CVE arayƒ±n...">
        <div class="filter-group">
            <button class="btn-filter active" onclick="setFilter('all', this)">Hepsi</button>
            <button class="btn-filter btn-exploited" onclick="setFilter('exploited', this)">‚ö†Ô∏è Exploit Edilenler</button>
            <button class="btn-filter btn-critical" onclick="setFilter('critical', this)">üî• Kritik (9.0+)</button>
            <button class="btn-filter" onclick="setFilter('high', this)">üî¥ Y√ºksek (7.0+)</button>
        </div>
        <div id="status">Veriler y√ºkleniyor...</div>
    </div>

    <div id="cve-list"></div>
</div>

<script>
    let allCVEs = [];
    let currentFilter = 'all';

    async function init() {
        try {
            const res = await fetch('./data.json?t=' + Date.now());
            allCVEs = await res.json();
            // Varsayƒ±lan olarak puanƒ± y√ºksek olanlarƒ± en √ºste alalƒ±m
            allCVEs.sort((a, b) => calculateScore(b) - calculateScore(a));
            applyFilters();

            document.getElementById('search-input').addEventListener('input', applyFilters);
        } catch (e) { document.getElementById('status').innerText = "Veri hatasƒ±."; }
    }

    function calculateScore(item) {
        let score = 0;
        const metrics = [...(item.containers?.cna?.metrics || []), ...(item.containers?.adp?.[0]?.metrics || [])];
        metrics.forEach(m => {
            const s = m.cvssV3_1?.baseScore || m.cvssV3_0?.baseScore || m.cvssV2?.baseScore || 0;
            if (s > score) score = s;
        });
        return score;
    }

    function setFilter(filter, el) {
        currentFilter = filter;
        document.querySelectorAll('.btn-filter').forEach(btn => btn.classList.remove('active'));
        el.classList.add('active');
        applyFilters();
    }

    function applyFilters() {
        const term = document.getElementById('search-input').value.toLowerCase();
        
        const filtered = allCVEs.filter(item => {
            const score = calculateScore(item);
            const isExploited = item.is_exploited || false;
            const textMatch = (item.containers?.cna?.descriptions?.[0]?.value || "").toLowerCase().includes(term) ||
                              (item.cveMetadata?.cveId || "").toLowerCase().includes(term) ||
                              (item.containers?.cna?.affected || []).some(p => (p.product || "").toLowerCase().includes(term));

            let categoryMatch = true;
            if (currentFilter === 'exploited') categoryMatch = isExploited;
            if (currentFilter === 'critical') categoryMatch = score >= 9.0;
            if (currentFilter === 'high') categoryMatch = score >= 7.0;

            return textMatch && categoryMatch;
        });

        render(filtered);
    }

    function render(data) {
        const container = document.getElementById('cve-list');
        document.getElementById('status').innerText = `‚úÖ ${data.length} sonu√ß listeleniyor.`;
        container.innerHTML = '';

        data.slice(0, 40).forEach(item => {
            const score = calculateScore(item);
            const cveId = item.cveMetadata?.cveId || "ID Yok";
            const products = (item.containers?.cna?.affected || []).map(p => `<span class="product-tag">${p.product || '√úr√ºn Bilgisi Yok'}</span>`).join("");
            
            let cweHTML = "";
            (item.containers?.cna?.problemTypes || []).forEach(prob => {
                prob.descriptions.forEach(desc => {
                    const cweMatch = desc.cweId || desc.description?.match(/CWE-\d+/)?.[0];
                    if (cweMatch) {
                        cweHTML += `<a href="https://cwe.mitre.org/data/definitions/${cweMatch.split('-')[1]}.html" target="_blank" class="cwe-tag">${cweMatch}</a>`;
                    }
                });
            });

            const card = document.createElement('div');
            card.className = 'cve-card';
            if (score >= 7) card.style.borderColor = 'var(--danger)';

            card.innerHTML = `
                ${item.is_exploited ? '<div class="exploit-badge">‚ö†Ô∏è AKTƒ∞F EXPLOIT EDƒ∞LDƒ∞</div>' : ''}
                <div class="cve-header">
                    <a href="https://nvd.nist.gov/vuln/detail/${cveId}" target="_blank" class="cve-id">${cveId}</a>
                    <span class="cvss-badge ${score >= 7 ? 'high-score' : ''}">CVSS: ${score > 0 ? score.toFixed(1) : 'N/A'}</span>
                </div>
                <div style="margin-bottom:8px;">${products}</div>
                <div class="desc">${item.containers?.cna?.descriptions?.[0]?.value || 'A√ßƒ±klama yok.'}</div>
                <div>${cweHTML || '<span class="cwe-tag">CWE Belirtilmemi≈ü</span>'}</div>
                <div class="meta-grid">
                    <div>üìÖ Tarih: <strong>${item.cveMetadata?.datePublished?.split('T')[0] || '-'}</strong></div>
                    <div>üìä Durum: <strong>${item.cveMetadata?.state || 'PUBLISHED'}</strong></div>
                    <div>‚öîÔ∏è <a href="https://attack.mitre.org/techniques/enterprise/" target="_blank" class="attack-link">MITRE Mapping ‚Üó</a></div>
                    <div>üîç <a href="https://www.google.com/search?q=${cveId}+exploit+poc+github" target="_blank" style="color:var(--accent); text-decoration:none;">PoC Ara</a></div>
                </div>
            `;
            container.appendChild(card);
        });
    }
    init();
</script>
</body>
</html>
